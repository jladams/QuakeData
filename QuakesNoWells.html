<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8"/>
		<title>OK Earthquakes</title>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<style>
		    html, body {
		        height: 100%;
		    }
		    #map {
		        height: 98%;
		    }
		</style>
		<script src="Leaflet.markercluster-master/dist/leaflet.markercluster.js" type="text/javascript"></script>
  		<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
  		<script src="past7days.js" type="text/javascript"></script>
        <script src="past30days.js" type="text/javascript"></script>
        <script src="faults.js" type="text/javascript"></script>
		<link rel="stylesheet" href="Leaflet.markercluster-master/dist/MarkerCluster.css" />
		<link rel="stylesheet" href="Leaflet.markercluster-master/dist/MarkerCluster.Default.css" />

	</head>

	<body>			
		<div id="map"></div>

		<script>
		    var map = L.map('map').setView([35.4, -98], 8);

            var Esri_WorldTopoMap = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
                maxZoom: 14,
	            attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community'
            }).addTo(map);
            
        	// Faults 
            var faults = L.geoJson(faults, {
                weight: 2,
                color: "red"
            });
            						    
		    //Quakes GeoJSON Layer
		    
		    var quakes7_data;
		    var quakes30_data;
		    
		    $.getJSON("http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson", function(data) {
				load7days(data);
		    	});
		    $.getJSON("http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson", function(data) {
				load30days(data);
		    	});

     		var quakesseven = L.markerClusterGroup().addTo(map);
     		var quakesthirty = L.markerClusterGroup();
     		

            var baseLayers = {
            	};
            	
            var overlays = {
            	"Past 7 Days" : quakesseven,
            	"Past 30 Days" : quakesthirty,
				"Faults" : faults
				};

            L.control.layers(baseLayers, overlays).addTo(map);
            
			// Scale
			L.control.scale({position: 'topright'}).addTo(map);
			     		
			function load7days(data) {
			    var quakes7 = L.geoJson(data, {
     		    	onEachFeature: function (feature, layer) {
     		    		temp = new Date(feature.properties.time);
         		    	layer.bindPopup("UTC Date/Time: " + temp.toUTCString() + "</br>Magnitude: " + feature.properties.mag, {
         			    	autoPan: false
         				})
         			},
         			pointToLayer: function (feature, latlng) {
         		    	return L.circleMarker(latlng, {
         		        	radius: feature.properties.mag * 5,
         		        	fillColor: "#ff7800",
         		        	color: "#000"
        		    	}
     				)}
 	        	});
 	        	quakesseven.addLayer(quakes7);
			};
			
			function load30days(data) {
			    var quakes30 = L.geoJson(data, {
     		    	onEachFeature: function (feature, layer) {
     		    		temp = new Date(feature.properties.time);
         		    	layer.bindPopup("UTC Date/Time: " + temp.toUTCString() + "</br>Magnitude: " + feature.properties.mag, {
         			    	autoPan: false
         				})
         			},
         			pointToLayer: function (feature, latlng) {
         		    	return L.circleMarker(latlng, {
         		        	radius: feature.properties.mag * 5,
         		        	fillColor: "#ff7800",
         		        	color: "#000"
        		    	}
     				)}
 	        	});
 	        	quakesthirty.addLayer(quakes30);
			};
		</script>
	</body>
</html>